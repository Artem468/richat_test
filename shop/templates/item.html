{% extends 'base.html' %}
{% load static %}
{% block title %}{{ item.name }}{% endblock %}
{% block content %}
    <div class="wrapperContainer">
        <div class="container">
            <h1>{{ item.name }}</h1>
            <p class="description">{{ item.description }}</p>
            <p class="price">Цена: {{ item.price }} {{ item.currency|upper }}</p>
            <button id="buyButton">Купить</button>
        </div>
    </div>
    <script src="https://js.stripe.com/basil/stripe.js"></script>
    <script>
        document.getElementById('buyButton').addEventListener('click', () => {
            const stripe = Stripe("{{ STRIPE_PUBLIС_KEY }}");
            fetch('/buy/{{ item.id }}/')
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                    return stripe.redirectToCheckout({sessionId: data.session_id});
                })
                .then(function (result) {
                    if (result.error) {
                        alert(result.error.message);
                    }
                });
        });
    </script>
{% endblock %}